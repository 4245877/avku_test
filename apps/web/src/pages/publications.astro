---
// src/pages/publications.astro
import Base from "../layouts/Base.astro";

import "../styles/pages/publications.css";

const lang = "uk";
const title = "АВКУ - Публікації";
const description = "Публікації — Асоціація Волонтерських Команд України";
---

<Base lang={lang} title={title} description={description}>
  <Fragment slot="head">
    <link rel="icon" href="/logo.png" type="image/png" />
    <link rel="shortcut icon" href="/logo.png" type="image/png" />

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
  </Fragment>

  <!-- Модальное окно для просмотра PDF -->
  <div id="pdfPreviewModal" class="pdf-modal" aria-hidden="true">
    <div class="pdf-modal-content" role="dialog" aria-modal="true" aria-labelledby="pdfModalTitle">
      <div class="pdf-modal-header">
        <h3 id="pdfModalTitle" data-translate="modal_title">Перегляд документу</h3>
        <div class="pdf-modal-actions">
          <a
            id="downloadPdfBtn"
            class="pdf-action-btn"
            href="#"
            download
            data-translate="modal_download"
          >
            <i class="fas fa-download"></i> Завантажити
          </a>
          <button id="closePdfModal" class="pdf-action-btn" type="button" aria-label="Close">
            <i class="fas fa-times"></i>
          </button>
        </div>
      </div>

      <div class="pdf-modal-body">
        <iframe id="pdfViewer" src="" width="100%" height="100%" frameborder="0"></iframe>
      </div>
    </div>
  </div>

  <main class="publications-page">
    <div class="publications-container">
      <h1 class="section-title" data-translate="publications_title">Публікації</h1>

      <!-- Поиск публикаций -->
      <div class="publications-search">
        <input
          type="text"
          class="search-input"
          id="publicationSearch"
          placeholder="Пошук публікацій..."
          data-translate="search_placeholder"
        />
      </div>

      <!-- Фильтр публикаций -->
      <div class="publications-filter">
        <button class="filter-btn active" type="button" data-filter="all" data-translate="filter_all">
          Всі
        </button>
        <button class="filter-btn" type="button" data-filter="reports" data-translate="filter_activities">
          Заходи
        </button>
        <button class="filter-btn" type="button" data-filter="research" data-translate="filter_research">
          Гуманітарна допомога
        </button>
        <button class="filter-btn" type="button" data-filter="guidelines" data-translate="filter_guidelines">
          Реабілітація
        </button>
        <button class="filter-btn" type="button" data-filter="reports" data-translate="filter_reports">
          Звіти
        </button>
      </div>

      <!-- Сетка публикаций -->
      <div class="publications-grid">
        <!-- Публикация 1 -->
        <div class="publication-card" data-category="reports">
          <div class="publication-thumbnail">
            <i class="fas fa-file-pdf"></i>
          </div>

          <div class="publication-info">
            <h3 class="publication-title" data-translate="pub1_title">ВОЛОНТЕРСЬКИЙ РУХ</h3>
            <div class="publication-date" data-translate="pub1_date">Грудень 2024</div>
            <p class="publication-description" data-translate="pub1_desc">Текст</p>

            <div class="publication-actions">
              <button
                class="publication-preview-btn"
                type="button"
                data-pdf="/publications/ВОЛОНТЕРСЬКИЙ_РУХ_ст_Колодій,Головач.pdf"
                data-title="Річний звіт АВКУ 2024"
                data-translate="preview_btn"
              >
                <i class="fas fa-eye"></i> Переглянути
              </button>

              <a
                href="/publications/ВОЛОНТЕРСЬКИЙ_РУХ_ст_Колодій,Головач.pdf"
                class="publication-download-btn"
                download
                data-translate="download_btn"
              >
                <i class="fas fa-download"></i> Завантажити
              </a>
            </div>
          </div>
        </div>

        <!-- Публикация 4 -->
        <div class="publication-card" data-category="reports">
          <div class="publication-thumbnail">
            <i class="fas fa-file-pdf"></i>
          </div>

          <div class="publication-info">
            <h3 class="publication-title" data-translate="pub4_title">ЗВІТ АВКУ - 2024</h3>
            <div class="publication-date" data-translate="pub4_date">Січень 2025</div>
            <p class="publication-description" data-translate="pub4_desc">Тест</p>

            <div class="publication-actions">
              <button
                class="publication-preview-btn"
                type="button"
                data-pdf="/publications/ЗВІТ - 2024.pdf"
                data-title="Квартальний звіт АВКУ Q3 2024"
                data-translate="preview_btn"
              >
                <i class="fas fa-eye"></i> Переглянути
              </button>

              <a
                href="/publications/ЗВІТ - 2024.docx"
                class="publication-download-btn"
                download
                data-translate="download_btn"
              >
                <i class="fas fa-download"></i> Завантажити
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Локальный скрипт для этой страницы (замена js/script.js для модалки/поиска/фильтров) -->
  <script is:inline>
    (function () {
      const modal = document.getElementById("pdfPreviewModal");
      const viewer = document.getElementById("pdfViewer");
      const titleEl = document.getElementById("pdfModalTitle");
      const closeBtn = document.getElementById("closePdfModal");
      const downloadBtn = document.getElementById("downloadPdfBtn");

      const openModal = (pdfUrl, title) => {
        if (!modal || !viewer || !downloadBtn) return;
        viewer.src = pdfUrl;
        downloadBtn.href = pdfUrl;
        if (titleEl) titleEl.textContent = title || "Перегляд документу";
        modal.classList.add("active");
        modal.setAttribute("aria-hidden", "false");
        document.body.style.overflow = "hidden";
      };

      const closeModal = () => {
        if (!modal || !viewer) return;
        modal.classList.remove("active");
        modal.setAttribute("aria-hidden", "true");
        viewer.src = "";
        document.body.style.overflow = "";
      };

      document.querySelectorAll(".publication-preview-btn[data-pdf]").forEach((btn) => {
        btn.addEventListener("click", () => {
          const pdf = btn.getAttribute("data-pdf");
          const t = btn.getAttribute("data-title") || btn.textContent?.trim();
          if (pdf) openModal(pdf, t);
        });
      });

      closeBtn?.addEventListener("click", closeModal);
      modal?.addEventListener("click", (e) => {
        if (e.target === modal) closeModal();
      });
      window.addEventListener("keydown", (e) => {
        if (e.key === "Escape") closeModal();
      });

      // Фильтр
      const filterBtns = Array.from(document.querySelectorAll(".filter-btn[data-filter]"));
      const cards = Array.from(document.querySelectorAll(".publication-card[data-category]"));

      const applyFilter = (filter) => {
        cards.forEach((card) => {
          const cat = card.getAttribute("data-category") || "";
          const show = filter === "all" ? true : cat === filter;
          card.style.display = show ? "" : "none";
        });
      };

      filterBtns.forEach((b) => {
        b.addEventListener("click", () => {
          filterBtns.forEach((x) => x.classList.remove("active"));
          b.classList.add("active");
          applyFilter(b.getAttribute("data-filter") || "all");
        });
      });

      // Поиск
      const search = document.getElementById("publicationSearch");
      const getText = (el) => (el.textContent || "").toLowerCase();

      search?.addEventListener("input", () => {
        const q = (search.value || "").trim().toLowerCase();
        cards.forEach((card) => {
          const title = getText(card.querySelector(".publication-title"));
          const desc = getText(card.querySelector(".publication-description"));
          const date = getText(card.querySelector(".publication-date"));
          const show = !q || title.includes(q) || desc.includes(q) || date.includes(q);
          card.style.display = show ? "" : "none";
        });
      });
    })();
  </script>
</Base>
